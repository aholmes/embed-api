<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js"><span id='MTVNPlayer'>/** 
</span> * MTVNPlayer {Object}
 * @static 
 */
var MTVNPlayer = MTVNPlayer || {};
if(!MTVNPlayer.Player){
    
<span id='MTVNPlayer-Events'>	/**
</span>	 * Events dispatched by {@link MTVNPlayer.Player}.
	 */
	MTVNPlayer.Events = {
<span id='MTVNPlayer-Events-event-METADATA'>			/**
</span>			 * @event
			 * Fired when the metadata changes. 
			 */
			METADATA:&quot;onMetadata&quot;,
<span id='MTVNPlayer-Events-event-STATE_CHANGE'>			/**
</span>			 * @event
			 * Fired when the state changes. 
			 */
			STATE_CHANGE:&quot;onStateChange&quot;,
<span id='MTVNPlayer-Events-event-MEDIA_START'>			/**
</span>			 * @event
			 * Fired once per playlist item (content + ads/bumpers)
			 */
			MEDIA_START:&quot;onMediaStart&quot;,
<span id='MTVNPlayer-Events-event-MEDIA_END'>			/**
</span>			 * @event
			 * Fired when a playlist item ends, this includes its prerolls and postrolls
			 */
			MEDIA_END:&quot;onMediaEnd&quot;,
<span id='MTVNPlayer-Events-event-PLAYHEAD_UPDATE'>			/**
</span>			 * @event
			 * Fired as the playhead moves
			 */
			PLAYHEAD_UPDATE:&quot;onPlayheadUpdate&quot;,
<span id='MTVNPlayer-Events-event-PLAYLIST_COMPLETE'>			/**
</span>			 * @event
			 * Fired once per playlist item (content + ads/bumpers)
			 */
			PLAYLIST_COMPLETE:&quot;onPlaylistComplete&quot;,
<span id='MTVNPlayer-Events-event-OVERLAY_RECT_CHANGE'>			/**
</span>			 * @event
			 * Fired when the GUI appears, event.data contains an {Object} {x:0,y:0,width:640,height:320}
			 */
			OVERLAY_RECT_CHANGE:&quot;onOverlayRectChange&quot;,
<span id='MTVNPlayer-Events-event-READY'>			/**
</span>			 * @event
			 * Fired once the API and metadata are available
			 */
			READY:&quot;onReady&quot;
	};
	
	// swfobject callback
	MTVNPlayer.onSWFObjectLoaded = null;
<span id='MTVNPlayer-Player-method-constructor'><span id='MTVNPlayer-Player'>	/**  
</span></span>	 * Create a new MTVNPlayer.Player
	 * @constructor
	 * Create a new MTVNPlayer.Player
	 * @param {String} id Target div id
	 * @param {Object} config config object {@link MTVNPlayer.Player#config}
	 * @param {Object} events Event callbacks {@link MTVNPlayer.Events}
	 */
	MTVNPlayer.Player = (function(window){

		&quot;use strict&quot;;
		
		// static methods variables
		var baseURL = &quot;http://media.mtvnservices.com/&quot;,
		swfobjectBase = baseURL+&quot;player/api/swfobject/&quot;,
		html5 = null,
		flash = null,
		jQuery = window.jQuery,
        throwError = function(message){
            throw new Error(&quot;Embed API:&quot;+message);
        },
		onPlayerCallbacks = null,
		document = window.document,
		isIDevice = (function(){
			var n = window.navigator.userAgent.toLowerCase();
			return n.indexOf(&quot;iphone&quot;) !== -1 || n.indexOf(&quot;ipad&quot;) !== -1;
		})(),
		getPath = function(config){
			if(config.templateURL){
				return config.templateURL.replace(&quot;{uri}&quot;,config.uri);
			}
			return baseURL + config.uri;
		},
		instances = [],
		jsonParse = function(){
			if(JSON){
				return function(str){
					if(str){
						return JSON.parse(str);
					}else{return null;}
				};
			}else if(jQuery){
				return function(str){
					return jQuery.parseJSON(str);
				};
			}
		}(),
		Player,
<span id='MTVNPlayer-Player-method-getPlayerInstance'>		/**
</span>		 * @method getPlayerInstance
		 * @private
		 * @param {ContentWindow} source
		 * @returns {MTVN.Player} A player instance
		 */
		getPlayerInstance = function(source){
			var i,
			player = null,
			numberOfInstances = instances.length,
			currentInstance;
			for(i = numberOfInstances;i--;){
				currentInstance = instances[i];
				if(currentInstance.source === source){
					// compare source (contentWindow) to get events object from the right player. (if flash, source is the embed id)
					player = currentInstance.player;
					break;
				}
			}
			return player;
		},
		message = function(message){
			if(this.isFlash){
				if(message === &quot;play&quot;){
					message = &quot;unpause&quot;;
				}
				var delimiterIndex = message.indexOf(&quot;:&quot;),
					methodName,
					args;
				if(delimiterIndex !== -1){
					methodName = message.slice(0,delimiterIndex);
					args = message.slice(delimiterIndex+1);
					return this.getPlayerElement()[methodName](args);
				}else{
					return this.getPlayerElement()[message]();
				}
			}
			return this.getPlayerElement().contentWindow.postMessage(message,&quot;*&quot;);
		},
<span id='MTVNPlayer-Player-method-checkEventName'>		/**
</span>		 * @method checkEventName
		 * @private
		 * @param {String} eventName
		 * Check if the event exists in our list of events.
		 */
		checkEventName = function(eventName){
			var event,
				events = MTVNPlayer.Events;
			for(event in events){
				if(events.hasOwnProperty(event) &amp;&amp; events[event] === eventName){
					return;
				}
			}
			throw new Error(&quot;MTVNPlayer.Player event:&quot; + eventName + &quot; doesn't exist.&quot;);
		},
<span id='MTVNPlayer-Player-method-checkEvents'>		/**
</span>		 * @method checkEvents
		 * @private
		 * @param {Object} events
		 * Loop through the events, and check the event names
		 */
		checkEvents = function(events){
			for(var event in events){
				if(events.hasOwnProperty(event)){
					checkEventName(event);
				}
			}
		},
<span id='MTVNPlayer-Player-method-processEvent'>		/**
</span>		 * @method processEvent
		 * @private
		 * @param {Object} {Array} event
		 * @param {Object} data
		 * Check if event is an Array, if so loop through, else just execute.
		 */
		processEvent = function(event,data){
			if(!event){
				return;
			}
			if(event instanceof Array){ // this will always be same-frame. (instanceof fails cross-frame.) 
				for(var i = event.length;i--;){
					event[i](data);
				}
			}else{
				event(data);
			}
		},
		
<span id='MTVNPlayer-Player-method-exitFullScreen'>		/**
</span>		 * return the iframe to it's original width and height
		 * @method exitFullScreen
		 * @private
		 * @param {MTVN.Player} player
		 */
		exitFullScreen = function(player){
			player.isFullScreen = false;
			var c = player.config,
				i = player.getPlayerElement();
			i.style.cssText = &quot;postion:static;z-index:auto;&quot;;
			i.width = c.width;
			i.height = c.height;
		},
		
<span id='MTVNPlayer-Player-method-goFullScreen'>		/**
</span>		 * @method goFullScreen
		 * @private
		 * @param {IFrameElement} iframeElement
		 */
		goFullScreen = function(player){
			var iframeElement = player.getPlayerElement(),
				highestZIndex = player.config.highestZIndex,
				cssText = player.config.fullScreenCssText;
			player.isFullScreen = true;
			iframeElement.style.cssText = cssText ? cssText : &quot;position:fixed;left:0px;top:0px;z-index:&quot; + (highestZIndex || 2147483645) + &quot;;&quot;;
			iframeElement.width = isIDevice ? window.innerWidth : &quot;100%&quot;; // 100% doesn't work on iPad.
			iframeElement.height = isIDevice ? window.innerHeight : &quot;100%&quot;;
			window.scrollTo(0,0);
		},
		
		initializeHTML = function(){
			
			initializeHTML = function(){}; // call only once
			
			html5 = {};
			
<span id='MTVNPlayer-Player-method-getMessageData'>			/**
</span>			 * @method getMessageData
			 * @private
			 */
			var getMessageData = function(data){
				return data.slice(data.indexOf(&quot;:&quot;)+1);
			},
<span id='MTVNPlayer-Player-method-onMetadata'>			/**
</span>			 * @method onMetadata
			 * @private
			 * @param {Object} data Event data
			 * @param {MTVN.Player} player A player instance
			 */
			onMetadata = function(data,player){
				var obj = jsonParse(getMessageData(data));
				player.currentMetadata = obj;
				if(obj.index !== -1){ // index is -1 for ads.
					player.playlistMetadata.items[obj.index] = obj;
					player.playlistMetadata.index = obj.index;
				}
				processEvent(player.events.onMetadata,{data:obj,target:player});
			},
			
<span id='MTVNPlayer-Player-method-handleMessage'>			/**
</span>			 * @method handleMessage
			 * @private
			 */
			handleMessage = function(event){
				var data = event.data,player,events;				
				if(data &amp;&amp; data.indexOf &amp;&amp; data.indexOf(&quot;logMessage:&quot;) === -1){
					player = getPlayerInstance(event.source);
					if(player){
						events = player.events;
						if(data.indexOf(&quot;playState:&quot;) === 0){
							player.state = getMessageData(data);
							processEvent(events.onStateChange,{data:player.state,target:player});
						}else if(data.indexOf(&quot;playlistComplete&quot;) === 0){
							processEvent(events.onPlaylistComplete,{data:null,target:player});
						}else if(data.indexOf(&quot;metadata:&quot;) === 0){
							onMetadata(data,player);
						}else if(data.indexOf(&quot;mediaStart&quot;) === 0){
							processEvent(events.onMediaStart,{data:null,target:player});
						}else if(data.indexOf(&quot;mediaEnd&quot;) === 0){
							processEvent(events.onMediaEnd,{data:null,target:player});
						}else if(data.indexOf(&quot;playheadUpdate&quot;) === 0){
							processEvent(events.onPlayheadUpdate,{data:parseInt(getMessageData(data),10),target:player});
						}else if(data.indexOf(&quot;playlistMetadata:&quot;) === 0){
							player.playlistMetadata = jsonParse(getMessageData(data));
						}else if(data === &quot;onReady&quot;){
							var fv = player.config.flashVars;
							if(fv &amp;&amp; fv.ssid){
								message.call(player,&quot;setSSID:&quot;+fv.ssid);
							}
							if(onPlayerCallbacks){
								onPlayerCallbacks(player);
							}
							processEvent(events.onReady,{data:null,target:player});
						}else if(data === &quot;fullscreen&quot;){
							if(player.isFullScreen){
								exitFullScreen(player);
							}else{
								player.isFullScreen = true;
								goFullScreen(player);
							}
						}else if(data.indexOf(&quot;overlayRectChange:&quot;) === 0){
                            processEvent(events.onOverlayRectChange,{data:jsonParse(getMessageData(data)),target:player});
						}
					}
				}
			};
<span id='MTVNPlayer-Player-method-create'>			/**
</span>			 * create the player iframe
			 * @method create
			 * @private
			 */
			html5.create = function(player){
				var config = player.config,
                element = document.createElement(&quot;iframe&quot;),
				targetDiv = document.getElementById(player.id);

				element.setAttribute(&quot;id&quot;,player.id);
				element.setAttribute(&quot;src&quot;,getPath(config));
				element.setAttribute(&quot;frameborder&quot;, &quot;0&quot;);
				element.setAttribute(&quot;scrolling&quot;, &quot;no&quot;);
				element.setAttribute(&quot;type&quot;, &quot;text/html&quot;);
				element.height = config.height;
				element.width = config.width;

				targetDiv.parentNode.replaceChild(element,targetDiv);
				
				if(typeof window.addEventListener !== 'undefined') { 
					window.addEventListener('message', handleMessage, false); 
				}else if(typeof window.attachEvent !== 'undefined') { 
					window.attachEvent('onmessage', handleMessage); 
				}
                instances.push({source:element.contentWindow,player:player});
			};
			
			// set up orientationchange handler for iPad
			var n = window.navigator.userAgent.toLowerCase();
			if(n.indexOf(&quot;ipad&quot;) !== -1){
				document.addEventListener(&quot;orientationchange&quot;, function(){
					var i,
					player = null,
					numberOfInstances = instances.length;
					for(i = numberOfInstances;i--;){
						player = instances[i].player;
						if(player.isFullScreen){
							goFullScreen(player);
						}
					}
				},false); 
			}
		},
<span id='MTVNPlayer-Player-method-initializeFlash'>		/**
</span>		 * set up handling of flash external interface calls
		 * create functions to map metadata to new format,
		 * and handle media player events
		 * @method initializeFlash
		 * @private
		 */
		initializeFlash = function(){
			
			initializeFlash = function(){}; // only call once
			
			flash = {};
			
			var swfobject = window.swfobject || MTVNPlayer.swfobject,
			
			makeWSwfObject = function(targetID,config){
				var attributes = config.attributes || {},
				params = config.params || {
					allowFullScreen:true
				},
				flashVars = config.flashVars || {};
				
				// we always want script access.
				params.allowScriptAccess = &quot;always&quot;;

				flashVars.objectID = targetID; // TODO objectID is used by the player.
				swfobject.embedSWF(getPath(config),targetID,config.width,config.height,&quot;10.0.0&quot;,
						swfobjectBase + &quot;expressInstall.swf&quot;,flashVars,params,attributes);
			},

			swfObjectInit = {
					requested:false,
					items:[]
			},

			onSWFObjectLoaded = function(loadedSwfObject){
				swfobject = loadedSwfObject;
				delete MTVNPlayer.onSWFObjectLoaded;
				for(var items = swfObjectInit.items, i = items.length; i--;){
					items[i]();
				}
			};
			
			MTVNPlayer.onSWFObjectLoaded = onSWFObjectLoaded;

			flash.create = function(player){

				var tag,firstScriptTag,targetID = player.id,config = player.config;
				
				instances.push({source:targetID,player:player});

				if(typeof(swfobject) === &quot;undefined&quot;){
					// queue request
					swfObjectInit.items.push(
							(function(elementId,elementConfig){
								var callBack  = function(){
									makeWSwfObject(elementId,elementConfig);
								};
								return callBack;
							}(targetID,config)));
					// load swf object
					if(!swfObjectInit.requested){
						swfObjectInit.requested = true;
						tag = document.createElement('script');
						tag.src = swfobjectBase + &quot;swfobject.js&quot;;
						tag.language = &quot;javascript&quot;;
						firstScriptTag = document.getElementsByTagName('script')[0];
						firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
					}
				}else{
					makeWSwfObject(targetID,config);
				}
			};
			
			MTVNPlayer.Player.flashEventMap = {};
			var processMetadata = function(metadata,playlistItems,index){
				var m = {},rss;
				m.duration = metadata.duration;
				// TODO no live. 
				m.live = false;
				m.isAd = metadata.isAd;
				m.isBumper = metadata.isBumper;
				if(index !== undefined){
					m.index = index;
				}else{
					m.index = function(guid){
						var len = playlistItems.length,
							i;
						for(i = len;i--;){
							if(playlistItems[i].metaData.guid === guid){
								return i;
							}
						}
						return -1;
					}(metadata.guid);
				}
				rss = m.rss = {};
				rss.title = metadata.title;
				rss.description = metadata.description;
				rss.guid = metadata.guid;
				rss.link = metadata.link;
				rss.image = metadata.thumbnail;
				rss.group = {};
				rss.group.categories = (function(){
					var displayData = metadata.displayData;
					return {
						isReportable:metadata.reportable,
						source:displayData.source,
						sourceLink:displayData.sourceLink,
						seoHTMLText:displayData.seoHTMLText
					};
				})();
				return m;
			},
			processPlaylistMetadata = function(metadata){
				var m = {}, 
					items = metadata.items,
					numberOfItems = items.length,
					i;
				m.description = metadata.description;
				m.title = metadata.title;
				m.link = metadata.link;
				m.items = [];
				for(i = numberOfItems; i--;){
					m.items[i] = processMetadata(items[i],null,i);
				}
				return m;
			},
			getPlaylistItemsLegacy = function(playlistItems){
				var m = {items:[]},
					numberOfItems = playlistItems.length,
					i;
				for(i = numberOfItems; i--;){
					m.items[i] = processMetadata(playlistItems[i].metaData,null,i);
				}
				return m;
			},
			addFlashEvents = function(player){
				var events = player.events, 
				map = MTVNPlayer.Player.flashEventMap,
				id = &quot;player&quot;+Math.round(Math.random()*1000000),
				element = player.getPlayerElement(),
				mapString = &quot;MTVNPlayer.Player.flashEventMap.&quot;+id,
				// this list of events is just for legibility. google closure compiler
				// will in-line the strings
				metadataEvent = MTVNPlayer.Events.METADATA, 
				stateEvent = MTVNPlayer.Events.STATE_CHANGE,
				playlistCompleteEvent = MTVNPlayer.Events.PLAYLIST_COMPLETE,
				readyEvent = MTVNPlayer.Events.READY,
				mediaEnd = MTVNPlayer.Events.MEDIA_END,
				mediaStart = MTVNPlayer.Events.MEDIA_START,
				playheadUpdate = MTVNPlayer.Events.PLAYHEAD_UPDATE,
				userReadyEvent = events[readyEvent],
				userMetadataEvent = events[metadataEvent];

				// the first metadata event will trigger the readyEvent
				if(userMetadataEvent || userReadyEvent){
					map[id+metadataEvent] = function(metadata){
						var playlistItems = player.getPlayerElement().getPlaylist().items,
							processedMetadata = processMetadata(metadata,playlistItems),
							playlistMetadata = player.playlistMetadata,
							fireReadyEvent = false;
						player.currentMetadata = processedMetadata;
						if(processedMetadata.index !== -1){ // index is -1 for ads.
							if(!playlistMetadata){
								// this is our first metadata event
								fireReadyEvent = true;
								try{
									playlistMetadata = processPlaylistMetadata(player.getPlayerElement().getPlaylistMetadata());
								}catch(e){
									playlistMetadata = getPlaylistItemsLegacy(playlistItems);
								}
							}
							playlistMetadata.items[processedMetadata.index] = processedMetadata;
							playlistMetadata.index = processedMetadata.index;
							player.playlistMetadata = playlistMetadata;
							if(fireReadyEvent &amp;&amp; userReadyEvent){
								processEvent(userReadyEvent,{data:processedMetadata,target:player});
							}
						}
						if(userMetadataEvent){
							processEvent(userMetadataEvent,{data:processedMetadata,target:player});
						}
					};
					element.addEventListener('METADATA',mapString+metadataEvent);
				}
				if(events[stateEvent]){
					map[id+stateEvent] = function(state){
						player.state = state;
						processEvent(events[stateEvent],{data:state,target:player});
					};
					element.addEventListener('STATE_CHANGE',mapString+stateEvent);
				}
				if(events[playheadUpdate]){
					map[id+playheadUpdate] = function(playhead){
						player.playhead = playhead;
						processEvent(events[playheadUpdate],{data:playhead,target:player});
					};
					element.addEventListener('PLAYHEAD_UPDATE',mapString+playheadUpdate);
				}
				if(events[playlistCompleteEvent]){
					map[id+playlistCompleteEvent] = function(){
						processEvent(events[playlistCompleteEvent],{data:null,target:player});
					};
					element.addEventListener('PLAYLIST_COMPLETE',mapString+playlistCompleteEvent);
				}
				if(events[mediaStart]){
					map[id+mediaStart] = function(){
						processEvent(events[mediaStart],{data:null,target:player});
					};
					// TODO does this fire for ads?
					element.addEventListener(&quot;READY&quot;,mapString+mediaStart);
				}
				if(events[mediaEnd]){
					map[id+mediaEnd] = function(){
						processEvent(events[mediaEnd],{data:null,target:player});
					};
					// yes, flash event is media ended unfort.
					element.addEventListener(&quot;MEDIA_ENDED&quot;,mapString+mediaEnd);
				}
			};
			window.mtvnPlayerLoaded = function(e){
				return function(id){
					if(e){
						e(id);
					}
					var player = getPlayerInstance(id);
					if(onPlayerCallbacks){
						onPlayerCallbacks(player);
					}
					addFlashEvents(player);
				};
			}(window.mtvnPlayerLoaded);
		},

		getEmbedCode = function(){
			
			var config = this.config,
				metadata = this.currentMetadata,
				displayDataPrefix = &quot;&lt;p style=\&quot;text-align:left;background-color:#FFFFFF;padding:4px;margin-top:4px;margin-bottom:0px;font-family:Arial, Helvetica, sans-serif;font-size:12px;\&quot;&gt;&quot;,
				displayMetadata = (function(){
					if(!metadata){
						return &quot;&quot;;
					}
					var copy = &quot;&quot;,
						categories = metadata.rss.group.categories,
						source = categories.source,
						sourceLink = categories.sourceLink,
						seoHTMLText = categories.seoHTMLText;
					if(source){
						if(sourceLink){
							copy += &quot;&lt;b&gt;&lt;a href=\&quot;&quot;+sourceLink+&quot;\&quot;&gt;&quot;+source+&quot;&lt;/a&gt;&lt;/b&gt;&quot;;
						}else{
							copy += &quot;&lt;b&gt;&quot;+source+&quot;&lt;/b&gt; &quot;;
						}
					}
					if(seoHTMLText){
						if(copy){
							copy += &quot;&lt;br/&gt;&quot;;
						}
						copy += &quot;Get More: &quot; + seoHTMLText;	
					}
					if(copy){
						copy = displayDataPrefix + copy + &quot;&lt;/p&gt;&quot;;
					}
					return copy;
				})(),
				embedCode = &quot;&lt;div style=\&quot;background-color:#000000;width:{divWidth}px;\&quot;&gt;&lt;div style=\&quot;padding:4px;\&quot;&gt;&quot; + 
					&quot;&lt;iframe src=\&quot;http://media.mtvnservices.com/embed/{uri}\&quot; width=\&quot;{width}\&quot; height=\&quot;{height}\&quot; frameborder=\&quot;0\&quot;&gt;&lt;/iframe&gt;&quot; +
					&quot;{displayMetadata}&lt;/div&gt;&lt;/div&gt;&quot;;
			embedCode = embedCode.replace(/\{uri\}/, config.uri);
			embedCode = embedCode.replace(/\{width\}/, config.width);
			embedCode = embedCode.replace(/\{divWidth\}/, config.width+8);
			embedCode = embedCode.replace(/\{height\}/, config.height);
			embedCode = embedCode.replace(/\{displayMetadata\}/, displayMetadata);
			return embedCode;
		},
		chainPlayerCreated = function(n){
			onPlayerCallbacks = function(e){
				return e ? function(p){e(p);n(p);} : n;
			}(onPlayerCallbacks);
		};
		// end private vars
		
<span id='MTVNPlayer-method-onPlayer'>		/**
</span>		 * @member MTVNPlayer
		 * If you want to know when players are created that you do not create, pass in a callback.
		 * @param {Function} callback A callback fired when every player is created.
		 */
		MTVNPlayer.onPlayer = function(callback){
			chainPlayerCreated(callback);
		};
        
<span id='MTVNPlayer-method-getPlayers'>		/**
</span>		 * @member MTVNPlayer
		 * Returns an array containing each {@link MTVNPlayer.Player} created.
		 * @returns {Array} An array containing each {@link MTVNPlayer.Player} created. 
		 */
        MTVNPlayer.getPlayers = function(){
            var result = [],
                i = instances.length;
            for(i; i--;){
                result.push(instances[i].player);
            }
            return result;
        };
		Player = function(targetID,config,events){
			
			this.isFlash = config.isFlash === undefined ? !isIDevice : config.isFlash;
			this.state =  this.currentMetadata = this.playlistMetadata = null;
<span id='MTVNPlayer-Player-cfg-config'>			/**
</span>			 * @cfg {Object} config The main configuration object.
			 * @cfg {String} [config.uri] (required) The URI of the media.
			 * @cfg {Number} [config.width] (required) The width of the player
			 * @cfg {Number} [config.height] (required) The height of the player
			 * @cfg {Object} [config.flashVars] Flashvars are passed to the flash player
			 * @cfg {Object} [config.attributes] Probably not useful (see [Adobe Help][1])
			 * [1]: http://kb2.adobe.com/cps/127/tn_12701.html
			 * @cfg {String} [config.fullScreenCssText] When the HTML5 player goes full screen, this is the css that is set on the iframe.
			 * @cfg {String} [config.templateURL] (For TESTING) A URL to use for the embed of iframe src. The template var for uri is {uri}, such as http://site.com/uri={uri}.
			 *
			 */
			this.config = config;
			this.id = targetID;
			this.events = events || {};
			checkEvents(events);
           
            // check for target div
            var targetDiv = document.getElementById(targetID),
                create = null;
            
            this.getPlayerElement = (function(){
                var container = null;
                return function(){
					if(!container){
						container = document.getElementById(this.id);
					}
					return container;
				};
			})();
                
            if(this.isFlash){
				initializeFlash();
                create = flash.create;
			}else{
				initializeHTML();
                create = html5.create;
			}
                
            if(!targetDiv){
                if(document.readyState === &quot;complete&quot;){
                    throwError(&quot;target div &quot; + targetID + &quot; not found&quot;);
                }else{
                    if(jQuery){
                        (function(ref){
                            jQuery(document).ready(function(){
                                if(document.getElementById(ref.id)){
                                    create(ref);
                                }else{
                                    throwError(&quot;target div &quot; + targetID + &quot; not found&quot;);
                                }
                            }); 
                        })(this);
                    }else{
                        throwError(&quot;Only call new MTVNPlayer.Player(targetID,..) after the targetID element is in the DOM.&quot;);
                    }
                }
                return;
            }else{
                create(this);
            }
		};

		// public api
		Player.prototype = {
<span id='MTVNPlayer-Player-method-play'>				/**
</span>				 * Begins playing or unpauses.
				 */
				play:function(){message.call(this,&quot;play&quot;);},
<span id='MTVNPlayer-Player-method-pause'>				/**
</span>				 * Pauses the media.
				 */
				pause:function(){message.call(this,&quot;pause&quot;);},
<span id='MTVNPlayer-Player-method-mute'>				/**
</span>				 * Mutes the volume
				 */
				mute:function(){message.call(this,&quot;mute&quot;);},
<span id='MTVNPlayer-Player-method-unmute'>				/**
</span>				 * Returns the volume to the level before it was muted.
				 */
				unmute:function(){message.call(this,&quot;unmute&quot;);},
<span id='MTVNPlayer-Player-method-playIndex'>				/**
</span>				 * Play an item from the playlist specified by the index
				 * @param {Number} index
				 */
				playIndex:function(index){message.call(this,&quot;playIndex:&quot;+index);},
<span id='MTVNPlayer-Player-method-playURI'>				/**
</span>				 * Play a new URI
				 * @param {String} uri
				 */
				playURI:function(uri){message.call(this,&quot;playUri:&quot;+uri);},
<span id='MTVNPlayer-Player-method-setVolume'>				/**
</span>				 * Change the volume
				 * @param {Number} value between 0 and 1.
				 */
				setVolume:function(v){message.call(this,&quot;volume:&quot;+v);},
<span id='MTVNPlayer-Player-method-seek'>				/**
</span>				 * Seeks to the time specified in seconds.
				 * @param {Number} value between 0 and the duration of the clip or playlist.
				 */
				seek:function(v){message.call(this,&quot;seek:&quot;+v);},
<span id='MTVNPlayer-Player-method-getEmbedCode'>				/**
</span>				 * Returns the embed code used to share this instance of the player
                 * @return {String} the embed code as a string.
				 */
				getEmbedCode:function(){return getEmbedCode.call(this);},
<span id='MTVNPlayer-Player-method-goFullScreen'>				/**
</span>				 * Puts the player in full screen mode, does not work for the flash player do the flash restrictions.
				 */
				goFullScreen:function(){
					if(html5){
						goFullScreen.apply(this,[this]);
					}
				},
<span id='MTVNPlayer-Player-method-exitFullScreen'>				/**
</span>				 * Exits full screen and returns the player to its initial embed size.
                 * Does not work with Prime builds older than 1.12. 
				 */
				exitFullScreen:function(){
					if(html5){
						exitFullScreen.apply(this,[this]);
					}else{
                        try{
                            this.getPlayerElement().exitFullScreen();
                        }catch(e){
                            // fail silently. exit full screen introduced in Prime 1.12
                        }
					}
				},
<span id='MTVNPlayer-Player-method-bind'>				/**
</span>				 * Adds an event listener for an event.
				 * @param {String} eventName an MTVNPlayer.Event.
				 * @param {Function} callback The function to invoke when the event is fired. 
				 */
				bind:function(eventName,callback){
					
					checkEventName(eventName);
					
					var currentEvent = this.events[eventName];
					if(!currentEvent){
						currentEvent = callback;
					}else if(currentEvent instanceof Array){
						currentEvent.push(callback);
					}else{
						currentEvent = [callback,currentEvent];
					}
					this.events[eventName] = currentEvent;
				},
<span id='MTVNPlayer-Player-method-unbind'>				/**
</span>				 * Removes an event listener
				 * @param {String} eventName an MTVNPlayer.Event.
				 * @param {Function} callback The function to that was bound to the event.
				 */
				unbind:function(eventName,callback){
					
					checkEventName(eventName);
					
					var i, 
						currentEvent = this.events[eventName];
					if(!currentEvent){
						return;
					}else if(currentEvent instanceof Array){
						for(i = currentEvent.length; i--;){
							if(currentEvent[i] === callback){
								currentEvent.splice(i,1);
								break;
							}
						}
					}else{
						this.events[eventName] = null;
					}
				}
		};

		return Player;
	}(window));

	// legacy method.
	if(typeof onPlayerAPIReady === &quot;function&quot;){
		onPlayerAPIReady();
	}
	
	if(typeof MTVNPlayer.onAPIReady === &quot;function&quot;){
		MTVNPlayer.onAPIReady();
	}
    
<span id='MTVNPlayer-property-isReady'>	/**
</span>	 * @member MTVNPlayer
	 * @property {Boolean} 
	 * If this is true, you wouldn't have to use the MTVNPlayer.addCallback() method.
	 */
    MTVNPlayer.isReady = true; 
}</pre>
</body>
</html>
